## HTTPS 为什么会出现

### HTTPS解决了什么问题？

HTTP不安全，由于明文传输的特性，在HTTP的传输过程中，任何人都有可以从中截获、修改或者伪造请求发送，所以可以认为HTTP是不安全的；在HTTP的传输过程中不会验证通信方的身份，信息交换双方可能会遭到伪装，也就是**没有用户验证**；同时也不会去**验证报文的完整性**。而HTTPS就是为了解决这些问题。

### 什么是HTTPS
 HTTP是一种超文本传输协议，在计算机世界里专门在两点之间传输文字、图片、音频、视频等超文本数据的约定和规范。
 HTTPS（Hypertext Transfer Protocol Secure）用来在计算机网络上的两个端系统之间进行安全的交换信息，它相当于在HTTP基础上加了一个Secure安全的词眼，定义：HTTPS是一个在计算机世界里专门在两点之间安全的传输文字、图片、音频、视频等超文本数据的约定和规范。HTTPS是HTTP的一种扩展，它本身并不保证传输的安全性。在HTTPS中，使用传输层安全性（TLS）或安全套接字层（SSL）对通信协议进行加密，也就是HTTP + SSL/TLS = HTTPS。

 ### HTTPS做了什么
 HTTPS协议提供了三个关键的指标
 + 加密（Encryption），HTTPS通过对数据加密来使其免受窃听者对数据的监听，意味着当用户在浏览网站时，没有人能够监听他和网站之间的信息交换，或者跟踪用户的活动，访问记录等，从而窃取用户信息。
 + 数据一致性(Data integrity)，数据在传输的过程中不会被窃听者修改，用户发送的数据会完整的传输到服务端，保证用户发的是什么，服务器接收的就是什么。
 + 身份认证（Authentication），是指确认对方的真实身份，也就是证明你是你（类比人脸识别），它可以防止中间人攻击并建立用户信任。
  
也就是说，除了协议名称和默认端口号外（HTTP 默认端口 80），HTTPS 协议在语法、语义上和 HTTP 一样，HTTP 有的，HTTPS 也照单全收。那么，HTTPS 如何做到 HTTP 所不能做到的安全性呢？关键在于这个 S 也就是 SSL/TLS 。

### 什么是SSL/TLS
#### 认识SSL/TLS
TLS是SSL的后续版本，它们都是在互联网两台计算机之间用于**身份验证**和**加密**的一种协议。SSL/TLS通过将称为X.509（公开密钥证书的标准格式）证书的数字文档将网站和公司的实体信息绑定到加密密钥来进行工作。每一个密钥对都有一个私有密钥和公有密钥，私有密钥是独有的，一般位于服务器上，用于解密由公共密钥加密过的信息；公有密钥是公有的，与服务器进行交互的每个人都可以持有公有密钥，用公钥加密的信息只能由私有密钥来解密。安全传输层协议（TLS）用于在两个通信应用程序之间提供保密性和数据完整性。
#### HTTPS的内核是HTTP
HTTPS并不是一项新的应用层协议，只是在HTTP通信接口部分由SSL和TLS替代而已。通常情况下，HTTP会先直接和TCP进行通信。在使用SSL的HTTPS后，则会演变为先和SSL进行通信，然后再由SSL和TCP进行通信。也就是说，**HTTPS就是身披一层SSL的HTTP。SSL是一个独立的协议，不只有HTTP可以使用，其他应用层协议也可以使用，比如SMTP（电子邮件协议）、Telnet（远程登录协议）等都可以使用。

### 探究HTTPS

SSL即**安全套接字层**，它在OSI七层网络模型中的第五层，SSL在1999年被IETF更名为TLS，即传输安全层，TLS目前公有三个版本，1.1、1.2、1.3，目前最广泛使用的是1.2，所以接下来的探讨都是基于TLS1.2的版本上的。

TLS用于两个通信应用程序之间提供保密性和数据完整性。TLS由记录协议、握手协议、警告协议、变更密码规范协议、扩展协议等几个子协议组成，综合使用了对称加密、非对称加密、身份认证等许多密码学前沿技术。

TLS的数据结构:  密钥交换算法 - 签名算法 - 对称加密算法 - 摘要算法
```encode
ECDHE-ECDSA-AES256-GCM-SHA384
```
TLS 在根本上使用**对称加密**和**非对称加密**两种形式。
#### 对称加密
密码学中有几个概念：
+ 明文：一般认为明文是具有意义的字符或者比特集，或者是通过某种公开编码就能获得的消息。
+ 密文：对明文进行某种加密后就变成了密文
+ 加密：把原始的信息（明文）转换为密文的信息变换过程
+ 解密：把已经加密的信息恢复成明文的过程

**对称加密**是指加密和解密时使用的密钥都是同样的密钥。只有保证了密钥的安全性，那么整个通信过程也就具有了机密性。TSL加密算法AES和chacha20等

#### 加密分组
对称加密算法还有一个分组模式的概念，对于GCM分组模式，一般搭配AES（它可以让算法用固定长度的密钥加密任意长度的明文）,其他的加密分组有GCM、CCM、Poly1305

#### 非对称加密
**非对称加密**也被称为公钥加密。密钥通过网络传输交换，它能够确保及时密钥被拦截，也不会暴露数据信息。非对称加密中有两个密钥，一个是公钥，一个是私钥，公钥进行加密，私钥进行解密。公开密钥可以供任何人使用，私钥只有服务上自己知道。使用公钥加密的文本只能使用私钥解密，同时，使用私钥加密的文本也可以使用公钥解密。常见的非对称加密算法RSA。

TLS 是使用**对称加密**和**非对称加密**的混合加密方式来实现机密性。

#### 混合加密

RSA的运算速度非常慢，而AES的加密速度比较快，而TLS正是使用了这种"混合加密"方式。在通信刚刚开始的时候使用非对称算法，比如RSA、ECDHE，首先解决密钥交换问题。然后用随机数产生对称算法使用的**会话密钥（session key）**，再用**公钥加密**。对方拿到密文后用**私钥解密**，取出会话密钥。这样，双方就实现了对称密钥的安全交换。

在机密性的基础上还要加上完整性、身份认证的特性，才能实现真正的安全。而实现完整性的主要手段是 摘要算法(Digest Algorithm)

#### 摘要算法

在TLS中，实现完整性的手段主要是摘要算法，例如MD5，全称是Message Digest Algorithm 5，它是属于密码哈希算法的一种，MD5可用于从任意长度的字符串创建128位字符串值。最常用于验证文件的完整性，也用于其他安全协议和应用程序中，例如SSH、SSL和Ipsec。一些应用程序通过向明文加盐值或多次应用哈希函数来增加MD5算法。

摘要算法可以理解成一种特殊的压缩算法，它能够把任意长度的数据压缩成一种固定长度的字符串，这就好像给数据加了一把锁。SHA-2 的全称是Secure Hash Algorithm 2，基于明文加密方式。但还是不够安全。

安全性更高的加密方式是使用 HMAC，MAC的全称是Message authentication code，它通过MAC算法从消息和密钥生成，MAC值允许验证者（也拥有私密密钥）检测到消息内容的任何更改，从而保护了消息的数据完整性。

HMAC是MAC更进一步的拓展，它是使用MAC值+hash值的组合方式，HMAC的计算中可以使用任何加密哈希函数，例如SHA-256等。

#### 认证

认证就是私钥加密，公钥解密。使用私钥再加上摘要算法，就能够实现数字签名，从而实现认证。这里还存在一个数字签名的认证问题。因为私钥是是自己的，公钥是谁都可以发布，所以必须发布经过认证的公钥，才能解决公钥的信任问题。

所以引入了 CA，CA 的全称是 Certificate Authority，证书认证机构，你必须让 CA 颁布具有认证过的公钥，才能解决公钥的信任问题。

通常情况下，数字证书的申请人将生成由私钥和公钥以及证书签名请求（CSR）组成的密钥对。CSR是一个编码的文本文件，其中包含公钥和其他将包含在证书中的信息（例如域名，组织，电子邮件地址等）。密钥对和 CSR生成通常在将要安装证书的服务器上完成，并且 CSR 中包含的信息类型取决于证书的验证级别。与公钥不同，申请人的私钥是安全的，永远不要向 CA（或其他任何人）展示。

生成 CSR 后，申请人将其发送给 CA，CA 会验证其包含的信息是否正确，如果正确，则使用颁发的私钥对证书进行数字签名，然后将其发送给申请人。